package backend.modes

import backend.{RegularPCElementConstantChecker, RegularPCElementOptimizer}
import backend.communication._
import backend.tree.RemoveConstantsSanitizer
import backend.tree.constraints.EventConstraint
import backend.tree.constraints.event_constraints.EventConstraintAllInOne
import org.scalatest.Ignore
import org.scalatest.funsuite.AnyFunSuite

@Ignore // Tests are too outdated to be useful at the moment
class SanitizerTest extends AnyFunSuite {

  test("Bug 1 (22-01-2020") {
    val JSONParsing = new ExploreTreeJsonParsing

    val content1: String =
      """{"type":"verify_intra","vi_type":"explore","iteration":267,"backend_id":0,"finished_run":true,"PC":[{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":0},"operator":"<","right":{"type":"SymbolicInt","i":5}},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":1},"operator":"<","right":{"type":"SymbolicInt","i":5}},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":2},"operator":"<","right":{"type":"SymbolicInt","i":5}},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":3},"operator":"<","right":{"type":"SymbolicInt","i":5}},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":4},"operator":"<","right":{"type":"SymbolicInt","i":5}},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":5},"operator":"<","right":{"type":"SymbolicInt","i":5}},"_wasTrue":false,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"function"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":false,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"function"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":false,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":0},"operator":"<","right":{"type":"SymbolicInt","i":0}},"_wasTrue":false,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":0},"operator":"<","right":{"type":"SymbolicInt","i":1}},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicArithmeticExp","operator":"+","args":[{"type":"SymbolicInt","i":0},{"type":"SymbolicInt","i":1}]},"operator":"<","right":{"type":"SymbolicInt","i":1}},"_wasTrue":false,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":0},"operator":"<","right":{"type":"SymbolicInt","i":1}},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":1},"operator":"<","right":{"type":"SymbolicInt","i":1}},"_wasTrue":false,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":0,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"TARGET","_symbolic":{"type":"SymbolicEventChosen","id":0,"processIdChosen":1,"eventIdChosen":0,"totalNrOfProcesses":2,"totalNrOfEvents":3,"target":{"processId":1,"targetId":0,"specificEventType":"keydown"}}},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":0},"operator":"<","right":{"type":"SymbolicInt","i":1}},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":1},"operator":"<","right":{"type":"SymbolicInt","i":1}},"_wasTrue":false,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInputInt","processId":1,"id":0},"operator":"==","right":{"type":"SymbolicInt","i":17}},"_wasTrue":false,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInputInt","processId":1,"id":0},"operator":"==","right":{"type":"SymbolicInt","i":91}},"_wasTrue":false,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicUnaryExp","operator":"!","argument":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInputInt","processId":1,"id":0},"operator":"==","right":{"type":"SymbolicInt","i":18}}},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInputInt","processId":1,"id":0},"operator":"==","right":{"type":"SymbolicInt","i":13}},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicRelationalExp","left":{"type":"SymbolicInt","i":0},"operator":"<","right":{"type":"SymbolicInt","i":0}},"_wasTrue":false,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicInputString","processId":1,"id":1},"_wasTrue":false,"_canBeNegated":true},{"_processId":1,"_type":"CONSTRAINT","_symbolic":{"type":"SymbolicStringOperationExp","args":[{"type":"SymbolicString","s":"object"},{"type":"SymbolicString","s":"object"}],"operator":"string_equal"},"_wasTrue":true,"_canBeNegated":true}],"processes_info":[{"id":0,"totalNrOfEvents":0},{"id":1,"totalNrOfEvents":3}]}"""

    val (id, parsedJSON) = ParsedJSON(content1)
    val input = (new VerifyIntraJsonParsing).parse(parsedJSON)
    val allInOne = EventConstraintAllInOne
    import allInOne._
    input match {
      case input: VIExploreModeInput[EventConstraint@unchecked] =>
        RemoveConstantsSanitizer.sanitize(input.exploreModeInput.pathConstraint)(
          RegularPCElementOptimizer[EventConstraint](), RegularPCElementConstantChecker[EventConstraint]())
    }
  }

}
